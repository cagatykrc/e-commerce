<%- include('./partials/header.ejs') %>
<main class="container mx-auto p-4 md:flex md:space-x-6">
  <!-- Left Column / Product Image -->
  <div class="w-full md:w-1/2 flex justify-center mb-4 md:mb-0">
    <img data-image="red" class="w-full max-w-md rounded-lg shadow-lg" src="/uploads/<%= urun.resim %>" alt="<%= urun.urun_basligi %>">
  </div>

  <!-- Right Column -->
  <div class="w-full md:w-1/2">
    <!-- Product Description -->
    <div class="mb-6">
      <span class="text-gray-500 uppercase text-sm font-semibold"><%= urun.kategoriler.kategori_ad %></span>
      <h1 class="text-2xl font-bold my-2"><%= urun.urun_basligi %></h1>
      <p class="text-gray-700"><%= urun.aciklama %></p>
    </div>

    <!-- Product Configuration -->
    <div class="mb-6">
      <form id="orderForm" action="/<%= urun.urun_id %>/sepetekle" method="POST" class="space-y-4">
        <input type="hidden" name="urunId" value="<%= urun.urun_id %>">
        <h1 class="text-xl font-semibold mb-2">Sipariş Seçenekleri</h1>
        <span class="text-gray-500">Ölçü Bilgileri 'cm' cinsinden</span>
        <a href="/cok-sorulan-sorular#curtain-measure" class="text-blue-500 hover:underline">Ölçü nedir? En ve Boy Ölçüsü Nasıl Alınır</a>
        <div class="space-y-4">
          <div>
            <label for="height" class="block text-gray-700 font-semibold">Boy (cm):</label>
            <select name="height" id="height" class="form-select mt-1 block w-full border-gray-300 rounded-md shadow-sm" required></select>
          </div>
          <div>
            <label for="width" class="block text-gray-700 font-semibold">En (cm):</label>
            <select name="width" id="width" class="form-select mt-1 block w-full border-gray-300 rounded-md shadow-sm" required></select>
          </div>
          <span class="text-lg font-semibold">Toplam fiyat: <span id="totalPrice">₺0</span></span>

        </div>
      </form>
    </div>

    <!-- Product Pricing -->
    <div>
      <div class="flex items-center space-x-4">
        <% if (discountRate > 8) { %>
        <div class="bg-green-600 text-white px-2 py-1 rounded text-sm font-bold">
          %<%= discountRate.toFixed(0) %>
        </div>
        <% } %>
        <div class="flex flex-col items-start">
          <% if (urun.discount_price) { %>
          <div class="flex items-center space-x-2">
            <span class="text-gray-500 line-through text-lg">₺<%= urun.discount_price %></span>
            <span class="text-lg font-bold text-black">₺<%= urun.product_price %></span>
          </div>
          <% } else { %>
            <span class="text-lg font-bold text-black">₺<%= urun.product_price %></span>
          <% } %>
        </div>
      </div>
      <div class="mt-4">
        <input type="submit" value="Sepete ekle" class="w-full py-2 px-4 bg-blue-500 text-white font-semibold rounded hover:bg-blue-600">
      </div>
    </div>
  </div>
</main>

<div class="container mx-auto p-4">
  <div class="bg-white rounded-lg shadow-md p-4">
    <h2 class="text-xl font-semibold mb-4">Açıklama</h2>
    <% if (urun.productdesc) { %>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="text-left text-gray-700 text-sm font-semibold uppercase p-2"><%= urun.kategoriler.kategori_ad %> Ürün Özellikleri</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr>
            <td class="p-2 font-semibold">Markası:</td>
            <td class="p-2"><%= urun.productdesc.brand %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Pile Sıklığı:</td>
            <td class="p-2"><%= urun.productdesc.pile_frequency %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Dikiş:</td>
            <td class="p-2"><%= urun.productdesc.stitching %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Ürün Temizlik:</td>
            <td class="p-2"><%= urun.productdesc.cleaning %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Renk:</td>
            <td class="p-2"><%= urun.productdesc.color %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Garanti:</td>
            <td class="p-2"><%= urun.productdesc.warranty %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Ödeme Seçenekleri:</td>
            <td class="p-2"><%= urun.productdesc.payment_options %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Tahmini Kargo:</td>
            <td class="p-2"><%= urun.productdesc.delivery_time %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Neme Dayanıklılık:</td>
            <td class="p-2"><%= urun.productdesc.moisture_resistance %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Ürün Detayları:</td>
            <td class="p-2"><%= urun.productdesc.product_composition %></td>
          </tr>
          <tr>
            <td class="p-2 font-semibold">Montaj Şekli:</td>
            <td class="p-2"><%= urun.productdesc.installation_areas %></td>
          </tr>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</div>

<%- include('./partials/footer.ejs') %>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  function populateSelect(elementId, start, end) {
    const selectElement = document.getElementById(elementId);
    for (let i = start; i <= end; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = i;
      selectElement.appendChild(option);
    }
  }

  // Boy için 50'den 400 cm'ye kadar olan aralığı doldur
  populateSelect("height", 50, 400);

  // En için 30'dan 300 cm'ye kadar olan aralığı doldur
  populateSelect("width", 30, 300);

  $(document).ready(function() {
    function calculateTotalPrice() {
      const height = parseFloat($('#height').val());
      const width = parseFloat($('#width').val());
      const productPrice = parseFloat('<%= urun.product_price %>');

      if (!isNaN(height) && !isNaN(width)) {
        const squareMeters = (height * width) / 10000;
        const totalPrice = squareMeters * productPrice;
        $('#totalPrice').text(`₺${totalPrice.toFixed(2)}`);
      } else {
        $('#totalPrice').text('₺0');
      }
    }

    $('#height, #width').on('input', calculateTotalPrice);
  });
</script>